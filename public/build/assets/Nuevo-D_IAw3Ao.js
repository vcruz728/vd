import{r as l,G as E,j as e,S as de,A as T}from"./app-CLURJkGK.js";import{A as oe,p as ie,s as ue,g as ce}from"./pageHeader-D_1LwfWO.js";import{T as F}from"./TituloCard-BeDKW1AC.js";import{S as me}from"./react-select.esm-DMnpdnqK.js";import{_ as pe,F as he,r as xe,p as je,a as ge}from"./suneditor-Rrmz5knS.js";import be from"./Copias-BvWYmrAV.js";import{V as o,R as m,B as g}from"./index-6M-nTxTF.js";import b from"./InputError-g248v_Br.js";import{S as B}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{V as A}from"./VerPdf-DXHcB1wc.js";/* empty css                     */import{E as V,l as ve,D as Ne}from"./es-MX-C92AoiMh.js";import{C as n}from"./Col-BmTaf4dG.js";import{C as p}from"./Card-DrgDsYzZ.js";import{T as fe,a as M}from"./Tabs-BsEQq-Nu.js";import{F as u}from"./Form-CZ3SpEJp.js";import"./commonimages-Db2ZVa_Y.js";import"./CloseButton-ZLY2bF9Q.js";import"./ElementChildren-KYUFPN3z.js";xe(je,ge);V.use(Ne);function Ie({status:Se,error:j,oficio:s,directorio:G,copy:S,directorioAll:k,externos:y,files:K,destinatariosOficio:z}){const C=l.useRef(null),[X,$]=l.useState(S),[c,v]=l.useState({destinatarioDos:!1,urlPdf:"",extension:"",id_usuario:0,tipo_usuario:0}),[H,P]=l.useState(!1),[I,q]=l.useState((K||[]).map(a=>{var r,t;return{...a,file:a.file||((t=(r=a.options)==null?void 0:r.metadata)==null?void 0:t.url),source:String(a.source),options:{...a.options,type:"local"},origin:1}})),[U,N]=l.useState([]),[J,_]=l.useState(!1),[O,W]=l.useState("0"),Q="<div>Por este medio le envío un cordial saludo, asimismo </div>";l.useEffect(()=>{f("id_oficio",(s==null?void 0:s.id)||0),i.setData("id",(s==null?void 0:s.id)||0),d.setData("id_oficio",(s==null?void 0:s.id)||0)},[s]),l.useEffect(()=>{$(S)},[S]),l.useEffect(()=>{if(j){const a=j.includes("|")?j.split("|")[0]:j;o("Error: "+a,{style:{padding:"25px",color:"#fff",backgroundColor:"#ff5b51"},position:"top-center"})}},[j]),l.useEffect(()=>{d.data.tipo=="1"?N(k):d.data.tipo=="2"&&N(y)},[z]);const{data:h,setData:f,errors:Y,post:Z,progress:ye,reset:Ce,setDefaults:_e,cancel:De}=E({id_oficio:(s==null?void 0:s.id)||0,destinatarioDos:s==null?void 0:s.tipo_destinatario,nombreDos:s==null?void 0:s.nombre,cargoDos:s==null?void 0:s.cargo,dependenciaDos:s==null?void 0:s.dependencia,dirigido_aDos:s==null?void 0:s.id_directorio,asunto:(s==null?void 0:s.respuesta)||Q,comentario:s==null?void 0:s.comentario}),ee=a=>{a.preventDefault(),Z(route("saveNuevoOficio"),{preserveScroll:!0,onSuccess:()=>o("Correcto: Se guardo la respuesta del oficio.",{style:{padding:"25px",color:"#fff",backgroundColor:"#29bf74"},position:"top-center"})})},d=E({id_oficio:(s==null?void 0:s.id)||0,id:0,tipo:""}),se=a=>{a.preventDefault(),d.post(route("oficios.saveDestinatarioNuevo"),{onSuccess:()=>{d.setDefaults({id_oficio:(s==null?void 0:s.id)||0,id:0,tipo:""}),d.reset("id"),C.current.clearValue(),o("Correcto: Se guardo la respuesta del oficio.",{style:{padding:"25px",color:"#fff",backgroundColor:"#29bf74"},position:"top-center"})},preserveScroll:!0})},ae=a=>{B.fire({title:"¿Está seguro?",text:"El destinatario se eliminará permanentemente.",icon:"warning",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, estoy seguro",denyButtonText:"Cancelar",customClass:{container:"swalSuperior"}}).then(r=>{r.isConfirmed&&T.delete(route("oficios.delDestinatario",{id:a}),{preserveScroll:!0,onSuccess:t=>{o("Correcto: Se elimino el destinatario.",{style:{padding:"25px",color:"#fff",backgroundColor:"#29bf74"},position:"top-center"})}})})},re=()=>{B.fire({title:"¿Está seguro?",text:"Una vez guardada la respuesta, esta se enviará y no se podrá editar",icon:"warning",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, estoy seguro",denyButtonText:"Cancelar",customClass:{container:"swalSuperior"}}).then(a=>{a.isConfirmed&&T.put(route("enviaOficioNuevo",{id:h.id_oficio}))})},L=a=>{v({...c,destinatarioDos:a!="Externo"}),C.current.clearValue(),f("destinatarioDos",a),a==="Externo"?(d.setData("tipo","2"),N(y)):(N(k),d.setData("tipo","1"))};function D(a){let t=("; "+document.cookie).split("; "+a+"=");return t.length===2?decodeURIComponent(t.pop().split(";").shift()):""}const te=()=>{if(parseInt(O)<=0){o("Error: Debe haber al menos un oficio para crear un oficio grupal.",{style:{padding:"25px",color:"#fff",backgroundColor:"#ff4d4f"},position:"top-center"});return}B.fire({title:"¿Está seguro?",text:"Se le asignaran los folios de oficio los cuales tendra que usar para el oficio grupal",icon:"warning",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, estoy seguro",denyButtonText:"Cancelar",customClass:{container:"swalSuperior"}}).then(a=>{a.isConfirmed&&T.post(route("nuevo.oficio.grupal",{numero:O}))})},i=E({id:s==null?void 0:s.id,archivo:null,descripcion:(s==null?void 0:s.descripcion)||""}),ne=a=>{a.preventDefault(),i.post(route("saveNuevoOficioGrupal"),{})},le=a=>{const r=a.target;r.files&&i.setData("archivo",r.files[0])};return e.jsxs(oe,{children:[e.jsxs(de,{children:[e.jsx("title",{children:"Nuevo oficio"}),e.jsx("meta",{name:"Nuevo oficio",content:"Modulo para dar de alta nuevos oficios"})]}),e.jsxs(l.Fragment,{children:[e.jsx(ie,{titles:"Nuevo Oficio",active:"Nuevo Oficio",items:[]}),e.jsx(m,{children:e.jsx(n,{md:12,children:e.jsxs(p,{children:[e.jsx(p.Header,{className:"d-flex justify-content-between",children:e.jsx(p.Title,{as:"h3",children:e.jsx(F,{titulo:"Formulario",obligatorio:!0})})}),e.jsx(p.Body,{children:e.jsx("div",{className:"panel panel-default",children:e.jsxs(fe,{defaultActiveKey:(s==null?void 0:s.masivo)==1?"tab2":"tab1",children:[e.jsx(M,{eventKey:"tab1",title:"Individual - Masivo",hidden:(s==null?void 0:s.masivo)==1,children:e.jsxs(m,{children:[e.jsxs(m,{className:"mt-5",children:[(s==null?void 0:s.descripcion_rechazo_jefe)!==void 0&&(s==null?void 0:s.descripcion_rechazo_jefe)!==null?e.jsxs(n,{xs:12,className:"mb-5",children:[e.jsx(u.Label,{children:"Breve descripción del rechazo por parte de su jefe de área:"}),e.jsx("textarea",{className:"form-control",value:s==null?void 0:s.descripcion_rechazo_jefe,rows:3,disabled:!0})]}):null,(s==null?void 0:s.descripcion_rechazo_final)!==void 0&&(s==null?void 0:s.descripcion_rechazo_final)!==null?e.jsxs(n,{xs:12,className:"mb-5",children:[e.jsx(u.Label,{children:"Breve descripción del rechazo por parte de recepción documental:"}),e.jsx("textarea",{className:"form-control",value:s==null?void 0:s.descripcion_rechazo_final,rows:3,disabled:!0})]}):null,e.jsx(n,{xs:12,children:e.jsx("h4",{children:"Ingrese aquí el cuerpo de la respuesta del oficio"})}),e.jsxs(n,{xs:12,children:[e.jsx(pe,{setContents:h.asunto,onChange:a=>{f("asunto",a)},setDefaultStyle:"font-family: 'SourceSansPro'; font-size: 12px;",setOptions:{lang:ue,buttonList:[["undo","redo"],["font","fontSize","formatBlock"],["paragraphStyle","blockquote"],["bold","underline","italic","strike","subscript","superscript"],["fontColor","hiliteColor"],["outdent","indent"],["align","horizontalRule","list","lineHeight"],["table","image"],["fullScreen"],["removeFormat"]],font:["SourceSansPro","Arial","Courier New","Times New Roman"],fontSize:[8,9,10,11,12,14,16,18,20,24,28,32],defaultTag:"div",minHeight:"300px",showPathLabel:!1,attributesWhitelist:{table:"style|width|height|cellpadding|cellspacing|border",tr:"style|height|valign",td:"style|width|height|colspan|rowspan"}}}),e.jsx(b,{className:"mt-1",message:Y.asunto})]}),e.jsxs(n,{xs:12,className:"mb-5 mt-5",children:[e.jsx(u.Label,{children:"Ingrese un comentario referente a la respuesta del oficio"}),e.jsx("textarea",{className:"form-control",value:h.comentario,onChange:a=>f("comentario",a.target.value),maxLength:1e3,rows:3})]}),e.jsx(n,{xs:12,className:"d-flex justify-content-end mt-5",children:e.jsx("button",{className:"btn btn-primary",onClick:ee,children:"Guardar oficio"})})]}),(s==null?void 0:s.id)!==void 0?e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:se,children:[e.jsx(n,{xs:12,className:"mt-5 mb-4",children:e.jsx(p.Header,{className:"d-flex justify-content-between",children:e.jsx(p.Title,{as:"h3",children:e.jsx(F,{titulo:"Destinatarios",obligatorio:!0})})})}),e.jsx(n,{md:6,xl:4,className:"mb-4",children:e.jsxs(u.Group,{children:[e.jsxs("label",{children:["Destinatario"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsxs("div",{className:"custom-controls-stacked",children:[e.jsxs("label",{className:"custom-control custom-radio-md",children:[e.jsx("input",{type:"radio",className:"custom-control-input",name:"destinatarioDos",defaultValue:"Interno",onChange:()=>{L("Interno")}}),e.jsx("span",{className:"custom-control-label",children:"Interno (BUAP)"})]}),e.jsxs("label",{className:"custom-control custom-radio-md",style:{marginLeft:"2rem"},children:[e.jsx("input",{type:"radio",className:"custom-control-input",name:"destinatarioDos",defaultValue:"Externo",onChange:()=>{L("Externo")}}),e.jsx("span",{className:"custom-control-label",children:"Externo"})]})]}),e.jsx(b,{className:"mt-1",message:d.errors.tipo})]})}),e.jsxs(m,{children:[e.jsx(n,{xs:12,sm:6,xl:4,children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"directorio",children:["Dirigido a:",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(me,{classNamePrefix:"Select",ref:C,options:U,name:"dirigido_aDos",placeholder:"Seleccione una opción",onChange:a=>d.setData({...d.data,id:a==null?void 0:a.value})}),e.jsx(b,{className:"mt-1",message:d.errors.id})]})}),e.jsx(n,{xs:12,className:"d-flex justify-content-end",children:e.jsx(g,{className:"btn btn-primary",type:"submit",children:"Guardar destinatario"})})]})]}),e.jsx(m,{children:e.jsx(n,{xs:12,children:e.jsx(V,{data:z,options:{language:ve,autoWidth:!1,ordering:!1},columns:[{data:"id",title:"Acciones",width:"10%"},{title:"Nombre",data:"nombre",width:"30%"},{title:"Cargo",data:"cargo",width:"30%"},{title:"Dependencia",data:"dependencia",width:"30%"}],className:"display table-bordered  border-bottom ancho100",slots:{0:(a,r)=>e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"btn-icon ml-1",variant:"danger",title:"Eliminar destinatario",onClick:()=>ae(r.id),children:e.jsx("i",{className:"fa fa-trash"})}),e.jsx(g,{className:"btn-icon ml-1",variant:"primary",title:"Ver oficiosss",onClick:()=>{v({...c,id_usuario:r.id_usuario,tipo_usuario:r.tipo_usuario}),P(!0)},children:e.jsx("i",{className:"fa fa-file-pdf-o"})})]})}})})}),e.jsxs(m,{children:[e.jsx(n,{xs:12,className:"mt-5 mb-4",children:e.jsx(p.Header,{className:"d-flex justify-content-between",children:e.jsx(p.Title,{as:"h3",children:e.jsx(F,{titulo:"Archivos adjuntos",obligatorio:!1})})})}),e.jsx(n,{children:e.jsx(he,{files:I,onupdatefiles:q,allowMultiple:!0,acceptedFileTypes:["application/pdf","image/jpeg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],onactivatefile:a=>{const r=a.getMetadata("url"),t=a.getMetadata("extension");r&&(t=="pdf"||t=="jpg"||t=="jpeg"||t=="png"?(v({...c,urlPdf:r,extension:t}),_(!0)):window.open(r,"_blank"))},filePosterMaxHeight:150,server:{process:{url:route("oficios.uploadFilesNew",{id:h.id_oficio}),method:"POST",withCredentials:!0,headers:{"X-XSRF-TOKEN":D("XSRF-TOKEN"),Accept:"application/json"},onload:a=>JSON.parse(a).id,onerror:a=>{let r="Error al subir archivo";try{const t=JSON.parse(a);t.errors&&t.errors.file&&t.errors.file.length>0?r=t.errors.file[0]:t.message&&(r=t.message)}catch{}return o.error(r),r}},revert:{url:route("oficio.deleteFile"),method:"DELETE",withCredentials:!0,headers:{"X-XSRF-TOKEN":D("XSRF-TOKEN")},onload:()=>(o.success("Archivo eliminado"),""),onerror:a=>{let r="Error al eliminar archivo";try{r=JSON.parse(a).error||r}catch{}return o.error(r),a}},remove:(a,r,t)=>{fetch(route("oficio.deleteFile"),{method:"DELETE",credentials:"include",headers:{"X-XSRF-TOKEN":D("XSRF-TOKEN")},body:a}).then(x=>{if(x.ok)o.success("Archivo eliminado"),r();else return x.json().then(R=>{const w=R.error||"Error al eliminar archivo";o.error(w),t(w)})}).catch(x=>{o.error("Error al eliminar archivo"),t("Error al eliminar archivo")})},load:(a,r,t,x,R,w)=>{r(new Blob)}},name:"file",labelIdle:'Arrastre y suelte sus archivos o <span class="filepond--label-action">Seleccionelos aquí</span>',onaddfile:(a,r)=>{r.origin===1&&r.getMetadata("url")&&setTimeout(()=>{const t=document.querySelector(`[data-filepond-item-id="${r.id}"] .filepond--file-info-main`);if(t){const x=r.getMetadata("url");t.innerHTML=`<a href="${x}" target="_blank" rel="noopener noreferrer">${r.filename}</a>`}},100)}})})]}),e.jsx(be,{id:h.id_oficio,directorio:G,externos:y,copias:X,tipo:0}),e.jsxs(m,{className:"mt-5",children:[e.jsx(n,{sm:12,md:3}),e.jsx(n,{sm:12,md:6,className:"d-flex justify-content-center",children:e.jsx("button",{className:"btn btn-primary",onClick:re,style:{marginRight:30},children:"Enviar a revisión"})}),e.jsx(n,{sm:12,md:3})]})]}):null]})}),e.jsx(M,{eventKey:"tab2",title:"Grupal",hidden:(s==null?void 0:s.masivo)!=1&&(s==null?void 0:s.masivo)!==void 0,children:e.jsxs(m,{children:[(s==null?void 0:s.descripcion_rechazo_jefe)!==void 0&&(s==null?void 0:s.descripcion_rechazo_jefe)!==null?e.jsxs(n,{xs:12,className:"mb-5",children:[e.jsx(u.Label,{children:"Breve descripción del rechazo por parte de su jefe de área:"}),e.jsx("textarea",{className:"form-control",value:s==null?void 0:s.descripcion_rechazo_jefe,rows:3,disabled:!0})]}):null,(s==null?void 0:s.descripcion_rechazo_final)!==void 0&&(s==null?void 0:s.descripcion_rechazo_final)!==null?e.jsxs(n,{xs:12,className:"mb-5",children:[e.jsx(u.Label,{children:"Breve descripción del rechazo por parte de recepción documental:"}),e.jsx("textarea",{className:"form-control",value:s==null?void 0:s.descripcion_rechazo_final,rows:3,disabled:!0})]}):null,(s==null?void 0:s.id)===void 0?e.jsxs(e.Fragment,{children:[e.jsx(n,{md:12,className:"d-flex justify-content-center mb-4",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"num_folios",children:"Numero de oficios que realizara"}),e.jsx("input",{type:"number",name:"num_folios",className:"form-control",onChange:a=>W(a.target.value)})]})}),e.jsx(n,{md:12,className:"d-flex justify-content-center mb-4",children:e.jsx(g,{className:"btn btn-primary",onClick:te,children:"Obtener Folio"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{md:12,className:"d-flex justify-content-center mb-4 mt-4",children:e.jsxs("h3",{children:["Numero de folio:"," ",s.folios_masivos]})}),e.jsxs("form",{onSubmit:ne,children:[e.jsxs(n,{xs:12,className:"mb-5",children:[e.jsx(u.Label,{children:"Breve descripción del motivo del oficio"}),e.jsx("textarea",{className:i.errors.descripcion?"form-control inputError":"form-control",defaultValue:i.data.descripcion,onChange:a=>i.setData("descripcion",a.target.value),rows:3}),e.jsx(b,{className:"mt-1",message:i.errors.descripcion})]}),e.jsxs(n,{xs:12,sm:6,md:6,lg:6,xl:4,className:"mb-3",children:[e.jsxs(u.Label,{children:["Adjuntar archivo PDF o Word"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(u.Control,{type:"file",accept:".pdf,.doc,.docx",className:i.errors.archivo?"inputError":"",onChange:a=>le(a)}),e.jsx(b,{className:"mt-1",message:i.errors.archivo})]}),(s==null?void 0:s.id)!==void 0&&(s==null?void 0:s.archivo)!==null?e.jsx(e.Fragment,{children:(s==null?void 0:s.archivo.substring((s==null?void 0:s.archivo.length)-3))!=="pdf"?e.jsx(n,{xs:12,style:{padding:40},children:e.jsxs("a",{className:"tag tag-radius tag-round tag-outline-danger",target:"_BLANK",href:ce(`/files/${s.archivo}`),children:["Click para descargar el archivo",e.jsx("i",{className:"fa fa-file-pdf-o",style:{padding:6}})]})}):e.jsx(n,{xs:12,style:{padding:40},children:e.jsxs("span",{className:"tag tag-radius tag-round tag-outline-danger",onClick:()=>{v({...c,urlPdf:s==null?void 0:s.archivo,extension:"pdf"}),_(!0)},children:["Click para ver archivo",e.jsx("i",{className:"fa fa-file-pdf-o",style:{padding:6}})]})})}):null,e.jsx(n,{xs:12,className:"mb-3 d-flex justify-content-end",children:e.jsx(g,{className:"btn btn-primary mt-4",type:"submit",children:"Guardar y enviar a revisión"})})]})]})]})})]})})})]})})}),e.jsx(A,{urlPdf:`imprime/nuevo/pdf/${h.id_oficio}/${c.id_usuario}/${c.tipo_usuario}`,show:H,setShow:P,tipo:"pdf"}),e.jsx(A,{urlPdf:c.urlPdf,show:J,tipo:c.extension,setShow:_})]})]})}export{Ie as default};
