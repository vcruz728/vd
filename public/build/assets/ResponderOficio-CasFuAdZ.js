import{r as n,G as oe,j as e,S as se,A as te}from"./app-BZjgC7cP.js";import{A as ae,p as re,s as ie}from"./pageHeader-B4CRHfJf.js";import{T as A}from"./TituloCard-D8KHv2fT.js";import{S as ne}from"./react-select.esm-LgsBVvNq.js";import{_ as le,F as ce,r as de,p as me,a as ue}from"./suneditor-vZlnSFO-.js";import he from"./Copias-XzlvgXwF.js";import{V as c,R as m,B as O}from"./index-DzsuHLcc.js";import x from"./InputError-DcwsGt1B.js";import{S as fe}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{V as P}from"./VerPdf-9nqVtfqh.js";/* empty css                     */import{E as M,l as xe,D as pe}from"./es-MX-Dpm40hYh.js";import{C as r}from"./Col-Do4GAVIT.js";import{C as p}from"./Card-B5etp3El.js";import{F as v}from"./Form-B08YK_CZ.js";import{M as ge,a as je,b as be,c as ve,d as Ne}from"./Modal-D5fA2oin.js";import"./commonimages-DICA3SGj.js";import"./CloseButton-9b_A4Smq.js";import"./ElementChildren-BWagFF9p.js";de(me,ue);M.use(pe);function qe({status:De,error:N,oficio:l,directorio:B,copy:D,respuesta:a,externos:S,directorioAll:F,files:L}){const y=n.useRef(null),[V,z]=n.useState(D),[u,g]=n.useState({destinatarioDos:!1,urlPdf:"",extension:""}),[H,w]=n.useState(!1),[X,I]=n.useState((L||[]).map(o=>{var s,t;return{...o,file:o.file||((t=(s=o.options)==null?void 0:s.metadata)==null?void 0:t.url),source:String(o.source),options:{...o.options,type:"local"},origin:1}})),[K,j]=n.useState([]),[$,b]=n.useState(!1),[q,C]=n.useState(!1),[G,J]=n.useState([]);n.useEffect(()=>{(a==null?void 0:a.id_directorio)!==void 0&&(a==null?void 0:a.id_directorio)!==null&&(a.tipo_destinatario==="Externo"?j(S):j(F),y.current.selectOption({value:a.id_directorio,label:a.nombre}))},[]),n.useEffect(()=>{z(D)},[D]),n.useEffect(()=>{N&&c("Error: "+N,{style:{padding:"25px",color:"#fff",backgroundColor:"#ff5b51"},position:"top-center"})},[N]);const U="<div>Por este medio le envío un cordial saludo, asimismo </div>",{data:d,setData:i,errors:h,post:W,progress:Se,reset:ye,setDefaults:we,cancel:Ce}=oe({id_oficio:l.id,destinatarioDos:a==null?void 0:a.tipo_destinatario,nombreDos:a==null?void 0:a.nombre,cargoDos:a==null?void 0:a.cargo,dependenciaDos:a==null?void 0:a.dependencia,dirigido_aDos:a==null?void 0:a.id_directorio,asunto:(a==null?void 0:a.respuesta)||U,comentario:a==null?void 0:a.comentario}),k=o=>{o.preventDefault(),W(route("saveRespuesta"),{preserveScroll:!0,onSuccess:()=>c("Correcto: Se guardo la respuesta del oficio.",{style:{padding:"25px",color:"#fff",backgroundColor:"#29bf74"},position:"top-center"})})},Q=async o=>{if(o==null)return;i("dirigido_aDos",o);const t=await(await fetch(route("getDetalleDirectorio",{id:o,tipo:d.destinatarioDos}),{method:"get"})).json();t.code==200?(i("nombreDos",t.data.nombre),i("cargoDos",t.data.cargo),i("dependenciaDos",t.data.dependencia)):c("Error: Intente de nuevo.",{style:{padding:"25px",color:"#fff",backgroundColor:"#ff5b51"},position:"top-center"})},Y=()=>{fe.fire({title:"¿Está seguro?",text:"Una vez guardada la respuesta, esta se enviará y no se podrá editar",icon:"warning",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Sí, estoy seguro",denyButtonText:"Cancelar",customClass:{container:"swalSuperior"}}).then(o=>{o.isConfirmed&&te.put(route("respondeOFicio",{id:l.id}))})},R=o=>{g({...u,destinatarioDos:!1}),i("destinatarioDos",o),y.current.clearValue(),j(o==="Externo"?S:F),i("nombreDos",""),i("cargoDos",""),i("dependenciaDos","")};function E(o){let t=("; "+document.cookie).split("; "+o+"=");return t.length===2?decodeURIComponent(t.pop().split(";").shift()):""}const Z=async()=>{const s=await(await fetch(route("oficios.getArchivosAdjuntos",{id:l.id,tipo:"id_oficio_inicial"}),{method:"get"})).json();J(s.data),C(!0)},ee=(o,s,t)=>{s==1?(g({...u,urlPdf:o,extension:t}),b(!0)):window.open(o,"_blank")};return e.jsxs(ae,{children:[e.jsxs(se,{children:[e.jsx("title",{children:"Responder oficio"}),e.jsx("meta",{name:"Responder oficio",content:"Modulo para dar respuesta al oficio asignado"})]}),e.jsxs(n.Fragment,{children:[e.jsx(re,{titles:"Responder Oficio",active:"Responder Oficio",items:[{titulo:"Mis oficios",urlHeader:"/oficios/mis-oficios"}]}),e.jsx(m,{children:e.jsx(r,{md:12,children:e.jsxs(p,{children:[e.jsxs(p.Header,{className:"d-flex justify-content-between",children:[e.jsx(p.Title,{as:"h3",children:e.jsx(A,{titulo:"Formulario de respuesta",obligatorio:!0})}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-warning btn-sm mb-3 mr-1",onClick:()=>Z(),style:{margin:"0 !important"},children:"Archivos Adjuntos"}),e.jsx("button",{className:"btn btn-danger btn-sm mb-3 mr-1",onClick:()=>{g({...u,urlPdf:l.archivo,extension:"pdf"}),b(!0)},style:{margin:"0 !important"},children:"Ver oficio inicial"}),e.jsx("button",{className:"btn btn-success btn-sm mb-3",onClick:()=>w(!0),style:{margin:"0 !important"},children:"Vista Previa"})]})]}),e.jsx(p.Body,{children:e.jsxs(m,{children:[l.descripcion_rechazo_jefe!==null?e.jsxs(r,{xs:12,className:"mb-5",children:[e.jsx(v.Label,{children:"Breve descripción del rechazo por parte de su jefe de área:"}),e.jsx("textarea",{className:"form-control",value:l.descripcion_rechazo_jefe,rows:3,disabled:!0})]}):null,l.descripcion_rechazo_final!==null?e.jsxs(r,{xs:12,className:"mb-5",children:[e.jsx(v.Label,{children:"Breve descripción del rechazo por parte de recepción documental:"}),e.jsx("textarea",{className:"form-control",value:l.descripcion_rechazo_final,rows:3,disabled:!0})]}):null,e.jsx(r,{md:6,xl:4,className:"mb-4",children:e.jsxs(v.Group,{children:[e.jsxs("label",{children:["Destinatario"," ",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsxs("div",{className:"custom-controls-stacked",children:[e.jsxs("label",{className:"custom-control custom-radio-md",children:[e.jsx("input",{type:"radio",className:"custom-control-input",name:"destinatarioDos",defaultValue:"Interno",onChange:()=>{R("Interno")},checked:d.destinatarioDos=="Interno"}),e.jsx("span",{className:"custom-control-label",children:"Interno (BUAP)"})]}),e.jsxs("label",{className:"custom-control custom-radio-md",style:{marginLeft:"2rem"},children:[e.jsx("input",{type:"radio",className:"custom-control-input",name:"destinatarioDos",defaultValue:"Externo",onChange:()=>{R("Externo")},checked:d.destinatarioDos=="Externo"}),e.jsx("span",{className:"custom-control-label",children:"Externo"})]})]}),e.jsx(x,{className:"mt-1",message:h.destinatarioDos})]})}),e.jsx(m,{children:e.jsx(r,{xs:12,sm:6,xl:4,children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"directorio",children:["Dirigido a:",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx(ne,{classNamePrefix:"Select",ref:y,options:K,name:"dirigido_aDos",placeholder:"Seleccione una opción",onChange:o=>Q(o==null?void 0:o.value)}),e.jsx(x,{className:"mt-1",message:h.dirigido_aDos})]})})}),e.jsxs(m,{children:[e.jsxs(r,{xs:12,sm:6,xl:4,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"",children:["Nombre",e.jsx("p",{className:"obligatorio",children:"*"})]}),e.jsx("input",{type:"text",name:"nombreDos",className:"form-control",onChange:o=>i("nombreDos",o.target.value),value:d.nombreDos,readOnly:!0})]}),e.jsx(x,{className:"mt-1",message:h.nombreDos})]}),e.jsxs(r,{xs:12,sm:6,xl:4,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"",children:"Cargo"}),e.jsx("input",{type:"text",name:"cargoDos",className:"form-control",onChange:o=>i("cargoDos",o.target.value),value:d.cargoDos,readOnly:!0})]}),e.jsx(x,{className:"mt-1",message:h.cargoDos})]}),e.jsxs(r,{xs:12,sm:6,xl:4,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"",children:"Dependencia"}),e.jsx("input",{type:"text",name:"dependenciaDos",className:"form-control",onChange:o=>i("dependenciaDos",o.target.value),value:d.dependenciaDos,readOnly:!0})]}),e.jsx(x,{className:"mt-1",message:h.dependenciaDos})]})]}),e.jsxs(m,{className:"mt-5",children:[e.jsx(r,{xs:12,children:e.jsx("h4",{children:"Ingrese aquí el cuerpo de la respuesta del oficio"})}),e.jsxs(r,{xs:12,className:"mb-5",children:[e.jsx(le,{setContents:d.asunto,onChange:o=>{i("asunto",o)},setDefaultStyle:"font-family: 'SourceSansPro'; font-size: 12px;",setOptions:{lang:ie,buttonList:[["undo","redo"],["font","fontSize","formatBlock"],["paragraphStyle","blockquote"],["bold","underline","italic","strike","subscript","superscript"],["fontColor","hiliteColor"],["outdent","indent"],["align","horizontalRule","list","lineHeight"],["table","image"],["fullScreen"],["removeFormat"]],font:["SourceSansPro","Arial","Courier New","Times New Roman"],fontSize:[8,9,10,11,12,14,16,18,20,24,28,32],defaultTag:"div",minHeight:"300px",showPathLabel:!1,attributesWhitelist:{table:"style|width|height|cellpadding|cellspacing|border",tr:"style|height|valign",td:"style|width|height|colspan|rowspan"}}}),e.jsx(x,{className:"mt-1",message:h.asunto})]}),e.jsxs(r,{xs:12,className:"mb-5",children:[e.jsx(v.Label,{children:"Ingrese un comentario referente a la respuesta del oficio"}),e.jsx("textarea",{className:"form-control",value:d.comentario,onChange:o=>i("comentario",o.target.value),maxLength:1e3,rows:3})]}),e.jsx(r,{xs:12,className:"d-flex justify-content-end mt-5",children:e.jsx("button",{className:"btn btn-primary",onClick:k,children:"Guardar Respuesta"})})]}),e.jsxs(m,{children:[e.jsx(r,{xs:12,className:"mt-5 mb-4",children:e.jsx(p.Header,{className:"d-flex justify-content-between",children:e.jsx(p.Title,{as:"h3",children:e.jsx(A,{titulo:"Archivos adjuntos",obligatorio:!1})})})}),e.jsx(r,{children:e.jsx(ce,{files:X,onupdatefiles:I,allowMultiple:!0,acceptedFileTypes:["application/pdf","image/jpeg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],onactivatefile:o=>{const s=o.getMetadata("url"),t=o.getMetadata("extension");s&&(t=="pdf"||t=="jpg"||t=="jpeg"||t=="png"?(g({...u,urlPdf:s,extension:t}),b(!0)):window.open(s,"_blank"))},filePosterMaxHeight:150,server:{process:{url:route("uploadFilesOficio",{id:l.id}),method:"POST",withCredentials:!0,headers:{"X-XSRF-TOKEN":E("XSRF-TOKEN"),Accept:"application/json"},onload:o=>JSON.parse(o).id,onerror:o=>{let s="Error al subir archivo";try{const t=JSON.parse(o);t.errors&&t.errors.file&&t.errors.file.length>0?s=t.errors.file[0]:t.message&&(s=t.message)}catch{}return c.error(s),s}},revert:{url:route("deleteFileOficio"),method:"DELETE",withCredentials:!0,headers:{"X-XSRF-TOKEN":E("XSRF-TOKEN")},onload:()=>(c.success("Archivo eliminado"),""),onerror:o=>{let s="Error al eliminar archivo";try{s=JSON.parse(o).error||s}catch{}return c.error(s),o}},remove:(o,s,t)=>{fetch(route("deleteFileOficio"),{method:"DELETE",credentials:"include",headers:{"X-XSRF-TOKEN":E("XSRF-TOKEN")},body:o}).then(f=>{if(f.ok)c.success("Archivo eliminado"),s();else return f.json().then(T=>{const _=T.error||"Error al eliminar archivo";c.error(_),t(_)})}).catch(f=>{c.error("Error al eliminar archivo"),t("Error al eliminar archivo")})},load:(o,s,t,f,T,_)=>{s(new Blob)}},name:"file",labelIdle:'Arrastre y suelte sus archivos o <span class="filepond--label-action">Seleccionelos aquí</span>',onaddfile:(o,s)=>{s.origin===1&&s.getMetadata("url")&&setTimeout(()=>{const t=document.querySelector(`[data-filepond-item-id="${s.id}"] .filepond--file-info-main`);if(t){const f=s.getMetadata("url");t.innerHTML=`<a href="${f}" target="_blank" rel="noopener noreferrer">${s.filename}</a>`}},100)}})})]}),e.jsx(he,{id:l.id,directorio:B,externos:S,copias:V,tipo:1}),e.jsxs(m,{className:"mt-5",children:[e.jsx(r,{sm:12,md:3}),e.jsxs(r,{sm:12,md:6,className:"d-flex justify-content-center",children:[e.jsx("button",{className:"btn btn-primary",onClick:Y,style:{marginRight:30},children:"Enviar Respuesta"}),e.jsx("button",{className:"btn btn-success",onClick:()=>w(!0),children:"Ver vista previa"})]}),e.jsx(r,{sm:12,md:3})]})]})})]})})}),e.jsx(P,{urlPdf:`imprime/pdf/0/${l.id}`,show:H,setShow:w,tipo:"pdf"}),e.jsx(P,{urlPdf:u.urlPdf,show:$,tipo:u.extension,setShow:b}),e.jsxs(ge,{size:"xl",show:q,onHide:()=>C(!1),children:[e.jsx(je,{children:e.jsx(be,{as:"h5",children:"Archivos adjuntos del oficio"})}),e.jsxs("form",{onSubmit:k,children:[e.jsx(ve,{children:e.jsxs(m,{children:[e.jsx(r,{xs:12,children:e.jsx(M,{data:G,options:{language:xe,autoWidth:!1},columns:[{data:"nombre",title:"Archivo"},{data:"id",title:"Ver"}],className:"display table-bordered  border-bottom ancho100",slots:{1:(o,s)=>e.jsx("div",{className:"text-center",children:e.jsx(O,{className:"btn-icon ml-1",variant:"danger",title:"Ver archivo",onClick:()=>ee(s.url,s.tipo,s.extension),children:e.jsx("i",{className:"fa fa-eye"})})})}})}),e.jsx(r,{xs:12,className:"mb-5 mt-5 d-flex justify-content-end",children:e.jsxs("a",{href:route("oficios.downloadFilesNew",{id:l.id,tipo:"id_oficio_inicial"}),target:"_BLANK",className:"btn btn-warning btn-lg mb-1",children:["Descargar todos los archivos adjuntos  ",e.jsx("i",{className:"fa fa-download"})]})})]})}),e.jsx(Ne,{children:e.jsx(O,{variant:"secondary",onClick:()=>C(!1),children:"Cerrar"})})]})]})]})]})}export{qe as default};
